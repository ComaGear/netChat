<?xml version="1.0" encoding="UTF-8" ?> <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--public boolean initializeChat();-->
<!--public List<Chat> getChatByNew(Integer obtainAmount);-->
<!--public List<Chat> getChatByAll();-->
<!--public boolean insertChat(Chat chat);-->
<!--public boolean deleteChat(Integer id);-->

<!--private Integer id;-->
<!--private User sender;-->
<!--private GroupChat group;-->
<!--private Date updateDate;-->
<!--private String message;-->

<mapper namespace="com.tomcat.netChat.repository.dao.ChatMapper">

    <select id="initializeChat">
        create table chat
        (
            id        int auto_increment not null,
            date      timestamp,
            message   text,
            group_id  int                not null,
            sender_id int                not null,
            primary key (id),
            foreign key (sender_id) references user (id),
            foreign key (group_id) references group (id)
        );
    </select>

    <select id="getChatByNew" resultType="com.tomcat.netChat.javaBeans.Chat">
        select *
        from chat
        where date
          and group_id = #{group.id}
        order by date
        limit #{obtainAmount};
    </select>

    <select id="getChatByAll" resultType="com.tomcat.netChat.javaBeans.Chat">
        select *
        from chat
        where group_id = #{group.id}
        order by date;
    </select>

    <insert id="insertChat">
        insert into chat (message, group_id, sender_id)
        values (#{message},
                #{group.id},
                #{sender.id});
    </insert>

    <insert id="deleteChat">
        delete
        from chat
        where #{id}
    </insert>
</mapper>